<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ì•ˆë‹¤ì¹˜ì¡° â€“ Wearable Real-time Dashboard</title>

  <!-- MQTT JS (Browser) -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

  <style>
    /* ============= Global ============= */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Pretendard", "Noto Sans KR", system-ui, sans-serif;
      background: radial-gradient(circle at 20% 10%, #E7F4EF, #F8FAF9 60%);
      color: #1f2a2c;
      padding: 24px;
    }

    .page { max-width: 1100px; margin: 0 auto; }

    /* ============= Header ============= */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .brand-left { display: flex; flex-direction: column; gap: 4px; }

    .brand-top { display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }

    .andachi-logo { width: 48px; height: 48px; }

    .team-badge {
      display: inline-flex; align-items: center;
      padding: 4px 12px;
      border-radius: 999px;
      background: rgba(15, 76, 58, 0.10);
      border: 1px solid rgba(15, 76, 58, 0.24);
      color: #0F4C3A; font-size: 13px; font-weight: 600;
    }

    .title { font-size: 30px; font-weight: 800; color: #0F4C3A; }
    .subtitle { font-size: 13px; color: #5F6A67; margin-top: 2px; }

    .header-right { font-size: 12px; color: #7d8a85; display: flex; align-items: center; }

    /* Layout */
    .main-grid {
      display: grid;
      grid-template-columns: 2.1fr 1.2fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .main-grid { grid-template-columns: 1fr; }
    }

    /* Cards */
    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 18px 20px;
      box-shadow: 0 10px 25px rgba(15, 76, 58, 0.07);
    }

    .card-title {
      font-size: 18px; font-weight: 700; color: #1f2a2c;
    }

    .card-sub {
      font-size: 13px;
      color: #6b7a78;
      margin-top: 6px;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    /* ============= Pills ============= */
    .pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .pill-low { background:#E4F6EC; color:#0F6A3A; }
    .pill-med { background:#FFF3D6; color:#A76B11; }
    .pill-high { background:#FFE1E1; color:#B3261E; }

    .emg-pill { font-size:11px; padding:2px 8px; margin-left:6px; }

    /* Metrics */
    .metric-row { margin-top: 16px; }

    .metric-top {
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: 4px;
    }

    .metric-label { font-size: 14px; font-weight: 600; }
    .metric-unit { font-size: 12px; color:#8a9896; margin-left:4px; }
    .metric-value { font-size:13px; color:#4d5b59; }

    /* Scale bar */
    .scale-bar {
      position: relative;
      height: 10px;
      border-radius: 999px;
      overflow: hidden;
      background: linear-gradient(
        to right,
        #C3E8D2 0%,
        #C3E8D2 33%,
        #FFE5AA 33%,
        #FFE5AA 66%,
        #FFC1C1 66%,
        #FFC1C1 100%
      );
      margin-bottom: 4px;
    }

    .scale-marker {
      position: absolute;
      top: -4px;
      width: 0; height: 18px;
      border-left: 3px solid #222;
    }

    .scale-caption {
      display: flex; justify-content: space-between;
      font-size: 11px; color:#8a9896;
    }

    .dot { margin-right:4px; font-size:10px; }

    .safe{color:#0F6A3A;} .warn{color:#A76B11;} .danger{color:#B3261E;}

    /* EMG Summary */
    .emg-summary-row {
      margin-top: 22px; padding: 12px 14px;
      border-radius: 14px;
      background:#F7FBFA; border:1px dashed #C7D9D4;
    }

    .emg-summary-title {
      font-size: 13px; font-weight: 600;
      color:#26413C; margin-bottom: 6px;
    }

    .emg-summary-text { font-size: 11px; line-height:1.5; }

    .hint-muted {
      font-size:11px; color:#9AA7A4; margin-top:4px; white-space:pre-line;
    }

    .lock-btn {
      margin-top:10px; padding:6px 12px;
      font-size:12px; border-radius:999px;
      border:1px solid #C7D9D4; background:#F7FBFA;
      cursor:pointer;
    }
    .lock-btn:disabled { opacity:0.6; cursor:default; }

    /* Right panel */
    .guide-title { font-size:17px; font-weight:700; margin-bottom:6px; }
    .guide-text { font-size:13px; line-height:1.5; color:#5F6A67; white-space:pre-line; }
    .divider { height:1px; background:#EEF3F2; margin:10px 0 12px; }

    .coach-status-pill{
      display:inline-flex; align-items:center;
      padding:4px 10px;
      border-radius:999px; background:#E7F4EF;
      font-size:12px; margin-bottom:6px;
    }
    .coach-status-pill-dot{
      width:7px; height:7px; border-radius:999px; margin-right:6px;
      background:#18A05D;
    }

    .coach-title{ font-size:15px;font-weight:700;margin-bottom:4px; }
    .coach-body{ font-size:13px; color:#5F6A67; white-space:pre-line; line-height:1.5; }
    .coach-tips{ font-size:11px; color:#9aa7a4; white-space:pre-line; }

  </style>
</head>

<body>
  <div class="page">

    <!-- HEADER -->
    <header class="header">
      <div class="brand-left">
        <div class="brand-top">
          <svg class="andachi-logo" viewBox="0 0 64 64">
            <circle cx="32" cy="32" r="30" fill="#0F4C3A" />
            <path d="M32 14 L21 18 v12 c0 8.5 5 14.5 11 17.5 c6-3 11-9 11-17.5 V18 Z"
              fill="#F8FAF9" />
          </svg>

          <div class="team-badge">ì•ˆë‹¤ì¹˜ì¡° ANDACHI</div>
        </div>

        <div class="title">Wearable Real-time Dashboard</div>
        <div class="subtitle">IMU + EMG ê¸°ë°˜ ì‹¤ì‹œê°„ ë¬´ë¦ ë¶€ìƒ ìœ„í—˜ ëª¨ë‹ˆí„°ë§</div>
      </div>

      <div class="header-right">
        <span class="last-update-label">Last update:</span>
        <span id="lastUpdated">-</span>
      </div>
    </header>


    <!-- MAIN GRID -->
    <div class="main-grid">

      <!-- LEFT -->
      <div>
        <div class="card">

          <!-- TITLE -->
          <div class="card-header">
            <div class="card-title" style="display:flex; flex-direction:column; line-height:1.2;">
              ì‹¤ì‹œê°„ ë¬´ë¦ ë¶€ìƒ ìœ„í—˜ë„
              <span style="font-size:10px; color:#C7CECC; margin-top:3px;">
                (ë¬´ë¦ ìƒëŒ€ ê°ì†ë„ í”¼í¬ê°’ ê¸°ë°˜)
              </span>
            </div>
          </div>

          <!-- ANGLE RATE -->
          <div class="metric-row">
            <div class="metric-top">
              <div>
                <span class="metric-label">ë¬´ë¦ ìƒëŒ€ ê°ì†ë„ í”¼í¬</span>
                <span class="metric-unit">(deg/s)</span>
              </div>

              <div class="metric-value">
                <span id="angleRateVal">-</span>
                <span> Â· </span>
                <span id="angleRateLevel"
                      class="pill pill-low"
                      style="font-size:14px; padding:4px 12px;">
                  LOW
                </span>
              </div>
            </div>

            <div class="scale-bar">
              <div id="angleRateMarker" class="scale-marker"></div>
            </div>

            <div class="scale-caption">
              <span class="safe"><span class="dot">â—</span>ì•ˆì • (&lt;100)</span>
              <span class="warn"><span class="dot">â—</span>ì£¼ì˜ (100â€“200)</span>
              <span class="danger"><span class="dot">â—</span>ìœ„í—˜ (&gt;=200)</span>
            </div>
          </div>

          <div class="card-sub">
            ì°©ì§€Â·ë°©í–¥ì „í™˜ ìˆœê°„ì— ë¬´ë¦ì´ ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ êº¾ì˜€ë‹¤ í´ì§€ëŠ”ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ê°’ì…ë‹ˆë‹¤.
            ì°©ì§€ ì¶©ê²©ì´ë‚˜ ë°©í–¥ ì „í™˜ ë¶€í•˜ê°€ í´ìˆ˜ë¡ ì´ ê°’ì´ ë†’ê²Œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆì–´ìš”.
          </div>

          <!-- EMG REPORT -->
          <div class="metric-row emg-summary-row">
            <div class="emg-summary-title">EMG ì„¸ì…˜ í”¼ë¡œ ë¶„ì„ ë¦¬í¬íŠ¸</div>

            <div class="emg-summary-text">
              RMS ì¦ê°€ìœ¨: <span id="emgRmsReport">-</span>%
              <span id="emgRmsLevel" class="pill emg-pill pill-low" style="display:none;">LOW</span><br/>

              MDF ê°ì†Œìœ¨: <span id="emgMdfReport">-</span>%
              <span id="emgMdfLevel" class="pill emg-pill pill-low" style="display:none;">LOW</span>
            </div>

            <div class="hint-muted">
              ìš´ë™ ì¢…ë£Œ í›„ ë²„íŠ¼ì„ ëˆŒëŸ¬ í•´ë‹¹ ì‹œì ì˜ ê°’ì„ ì„¸ì…˜ ë¦¬í¬íŠ¸ë¡œ ì €ì¥í•˜ì„¸ìš”.
            </div>

            <button id="lockEmgReportBtn" type="button" class="lock-btn">
              ìš´ë™ ì¢…ë£Œ Â· ë¦¬í¬íŠ¸ ê³ ì •í•˜ê¸°
            </button>

            <div id="lockStatusText" class="hint-muted" style="margin-top:6px;">
              ì•„ì§ ì„¸ì…˜ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ìš´ë™ì„ ë§ˆì¹˜ë©´ ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¦¬í¬íŠ¸ë¥¼ ê³ ì •í•˜ì„¸ìš”.
            </div>
          </div>
        </div>
      </div>


      <!-- RIGHT -->
      <div>
        <div class="card">

          <div class="guide-title">ë¶€ìƒ ì˜ˆë°© ê°€ì´ë“œ</div>
          <div id="guideText" class="guide-text">
            ì„¼ì„œê°€ ì•ˆì •ì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ë©´ ì´ ì˜ì—­ì— í˜„ì¬ ìœ„í—˜ ìš”ì¸ê³¼
            ì˜ˆë°© í–‰ë™ì´ í‘œì‹œë©ë‹ˆë‹¤.
          </div>

          <div class="divider"></div>

          <div class="guide-title" style="font-size:16px;">AI ìì„¸ êµì • ì½”ë©˜íŠ¸</div>

          <div id="coachStatusPill" class="coach-status-pill">
            <span class="coach-status-pill-dot"></span>
            <span id="coachStatusText">ì•ˆì „ ìì„¸</span>
          </div>

          <div id="coachTitle" class="coach-title">ì¢‹ì€ ìì„¸ë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ìš”</div>
          <div id="coachBody" class="coach-body">
            ì›€ì§ì„ì„ ì‹œì‘í•˜ë©´ ì„¼ì„œ ê¸°ë°˜ìœ¼ë¡œ ìì„¸ í”¼ë“œë°±ì´ í‘œì‹œë©ë‹ˆë‹¤.
          </div>

          <div id="coachTips" class="coach-tips">
            ê¸°ì¤€ê°’ ê°ì†ë„: &lt;100 low Â· 100â€“200 med Â· â‰¥200 high  
            EMG í”¼ë¡œë„ëŠ” RMS ì¦ê°€ìœ¨Â·MDF ê°ì†Œìœ¨ë¡œ ìš”ì•½ë©ë‹ˆë‹¤.
          </div>

        </div>
      </div>

    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    const BROKER_URL = "wss://damoa.io:9002";
    const RISK_TOPIC = "ewha/2270056/risk";

    const clientId = "andachi-web-" + Math.random().toString(16).substring(2,10);
    const client = mqtt.connect(BROKER_URL, { clientId });

    let emgReportLocked = false;
    let emgReportSnapshot = null;

    client.on("connect", () => { client.subscribe(RISK_TOPIC); });
    client.on("message", (t, msg) => {
      if (t === RISK_TOPIC) {
        updateDashboard(JSON.parse(msg.toString()));
      }
    });

    function fmt(v,d=1){ return (v==null||!isFinite(v))? "-" : v.toFixed(d); }
    function levelClass(lv){ return lv==="high"?"pill-high":lv==="med"?"pill-med":"pill-low"; }
    function clamp(p){ return Math.max(0,Math.min(100,p)); }

    /* =====================
       EMG í•´ì„ í•¨ìˆ˜ (ìµœì¢… ê°œì„  ë²„ì „)
       ===================== */
    function getEmgSessionSummary(rms, mdf) {

      const R = isFinite(rms)? rms : null;
      const M = isFinite(mdf)? mdf : null;

      let rmsLine="", mdfLine="", rec="";

      /* RMS í•´ì„ */
      if (R === null) {
        rmsLine = "RMS ì¦ê°€ìœ¨ì„ ì¶”ì •í•˜ê¸°ì— ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
      } else if (R < 10) {
        rmsLine = `RMSëŠ” ì•½ ${R.toFixed(1)}% ì¦ê°€í•´, ê·¼ ì‚¬ìš©ëŸ‰ ë³€í™”ê°€ í¬ì§€ ì•Šì€ í¸ì…ë‹ˆë‹¤.`;
      } else if (R < 30) {
        rmsLine = `RMSëŠ” ì•½ ${R.toFixed(1)}% ì¦ê°€í•´, í›„ë°˜ë¶€ì— ê·¼ ì‚¬ìš©ëŸ‰ì´ ë‹¤ì†Œ ì¦ê°€í•œ ìƒíƒœì…ë‹ˆë‹¤.`;
      } else {
        rmsLine = `RMSëŠ” ì•½ ${R.toFixed(1)}% ì¦ê°€í•´, í›„ë°˜ë¶€ì— ê·¼ ë¶€ë‹´ì´ ëšœë ·í•˜ê²Œ ì»¤ì§„ ìƒíƒœì…ë‹ˆë‹¤.`;
      }

      /* MDF í•´ì„ */
      if (M === null) {
        mdfLine = "MDF ê°ì†Œìœ¨ì„ ì•ˆì •ì ìœ¼ë¡œ ì¶”ì •í•˜ê¸° ì–´ë ¤ì› ìŠµë‹ˆë‹¤.";
      } else if (M < 10) {
        mdfLine = `MDFëŠ” ì•½ ${M.toFixed(1)}% ê°ì†Œí•´, í”¼ë¡œ ëˆ„ì ì´ í¬ì§€ ì•Šì€ í¸ì…ë‹ˆë‹¤.`;
      } else if (M < 30) {
        mdfLine = `MDFëŠ” ì•½ ${M.toFixed(1)}% ê°ì†Œí•´, í”¼ë¡œê°€ ì„œì„œíˆ ëˆ„ì ë˜ëŠ” íë¦„ì…ë‹ˆë‹¤.`;
      } else {
        mdfLine = `MDFëŠ” ì•½ ${M.toFixed(1)}% ê°ì†Œí•´, í›„ë°˜ë¶€ì— í”¼ë¡œê°€ ëšœë ·í•˜ê²Œ ì¦ê°€í•œ ìƒíƒœì…ë‹ˆë‹¤.`;
      }

      /* ì¢…í•© ê¶Œì¥ í–‰ë™ */
      if ((R !== null && R >= 30) || (M !== null && M >= 30)) {
        rec =
          "ê·¼ í”¼ë¡œì™€ ë¶€ë‹´ì´ í¬ê²Œ ë‚˜íƒ€ë‚œ ì„¸ì…˜ì…ë‹ˆë‹¤.\n" +
          "ì˜¤ëŠ˜ì€ ê°•í•œ ìš´ë™ì„ í”¼í•˜ê³ , ìŠ¤íŠ¸ë ˆì¹­Â·í¼ë¡¤ë§Â·íœ´ì‹ì„ ì¤‘ì‹¬ìœ¼ë¡œ íšŒë³µì— ì§‘ì¤‘í•´ ì£¼ì„¸ìš”.\n" +
          "ë¬´ë¦ ì•ˆì •ì„±ì„ ìœ„í•´ ë‹¤ìŒ ëŸ¬ë‹ì€ ì¶©ë¶„íˆ íšŒë³µëœ ë’¤ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.";
      } else if ((R !== null && R >= 10) || (M !== null && M >= 10)) {
        rec =
          "ê·¼ í”¼ë¡œê°€ ëˆ„ì ë˜ëŠ” íë¦„ì´ ë³´ì…ë‹ˆë‹¤.\n" +
          "ë‹¤ìŒ ëŸ¬ë‹ ì „ ì›Œë°ì—… ì‹œê°„ì„ ì¡°ê¸ˆ ë” í™•ë³´í•˜ê³ ,\n" +
          "ì´ë²ˆ ì£¼ëŠ” ê°•ë„ì™€ ê±°ë¦¬ë¥¼ í‰ì†Œë³´ë‹¤ ë³´ìˆ˜ì ìœ¼ë¡œ ì¡°ì ˆí•´ ì£¼ì„¸ìš”.";
      } else {
        rec =
          "í”¼ë¡œ ëˆ„ì ì´ í¬ì§€ ì•Šì€ ì•ˆì •ì ì¸ ì„¸ì…˜ì´ì—ˆìŠµë‹ˆë‹¤.\n" +
          "ì§€ê¸ˆì²˜ëŸ¼ ë¬´ë¦¬í•˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ì ì§„ì ìœ¼ë¡œ í›ˆë ¨ì„ ì´ì–´ê°€ë©´ ì¢‹ìŠµë‹ˆë‹¤.";
      }

      return `ì„¸ì…˜ ë¦¬í¬íŠ¸ê°€ ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n${rmsLine}\n${mdfLine}\n\n${rec}`;
    }

    /* ========== EMG ë Œë”ë§ ========== */
    function renderEmg(rms, mdf, rmsLv, mdfLv){
      document.getElementById("emgRmsReport").textContent = fmt(rms);
      document.getElementById("emgMdfReport").textContent = fmt(mdf);

      const rPill=document.getElementById("emgRmsLevel");
      const mPill=document.getElementById("emgMdfLevel");

      if (!isFinite(rms)) rPill.style.display="none";
      else {
        rPill.style.display="inline-flex";
        rPill.className="pill emg-pill "+levelClass(rmsLv);
        rPill.textContent=rmsLv.toUpperCase();
      }

      if (!isFinite(mdf)) mPill.style.display="none";
      else {
        mPill.style.display="inline-flex";
        mPill.className="pill emg-pill "+levelClass(mdfLv);
        mPill.textContent=mdfLv.toUpperCase();
      }
    }

    /* ========== ì½”ì¹­ ë¬¸êµ¬ ========== */
    function getCoaching(overall, angLv, rmsLv, mdfLv){
      let status,title,body,guide;

      if (overall==="low"){
        status="ğŸŸ¢ LOW ìœ„í—˜ë„";
        title="í˜„ì¬ ìƒíƒœ ì–‘í˜¸í•©ë‹ˆë‹¤.";
        body="ê°€ë³ê²Œ ë‹¬ë¦¬ê¸°ë¥¼ ì§„í–‰í•´ë„ ì¢‹ì€ ìƒíƒœì…ë‹ˆë‹¤.\në¬´ë¦ ì§€ì§€ ê·¼ìœ¡ì„ ê¾¸ì¤€íˆ ê°•í™”í•´ ì£¼ì„¸ìš”.";
        guide="â€¢ ë™ì  ì›Œë°ì—… 5â€“10ë¶„\nâ€¢ ëŸ¬ë‹ í›„ ìŠ¤íŠ¸ë ˆì¹­ 20â€“30ì´ˆ ìœ ì§€";
      }
      else if (overall==="med"){
        status="ğŸŸ¡ MED ìœ„í—˜ë„";
        title="ë¶€í•˜ ë˜ëŠ” í”¼ë¡œ ì¦ê°€ ì‹ í˜¸ì…ë‹ˆë‹¤.";
        body="ì¶©ê²© ë˜ëŠ” ê·¼ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤.\nì˜¤ëŠ˜ì€ ê°•ë„ë¥¼ ì•½ê°„ ì¤„ì´ë©´ ì¢‹ìŠµë‹ˆë‹¤.";
        guide="â€¢ í‰ì†Œ ëŒ€ë¹„ 70â€“80% ê°•ë„ë¡œ ì¡°ì ˆ\nâ€¢ í™Â·ì¢…ì•„ë¦¬ ê°•í™”ìš´ë™ ì¶”ê°€";
      }
      else{
        status="ğŸ”´ HIGH ìœ„í—˜ë„";
        title="ë¶€ìƒ ìœ„í—˜ì´ ë†’ì€ ìƒíƒœì…ë‹ˆë‹¤.";
        body="ê°ì†ë„ ë˜ëŠ” í”¼ë¡œë„ê°€ í¬ê²Œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.\nëŸ¬ë‹ ê°•ë„ë¥¼ ì¦‰ì‹œ ë‚®ì¶”ê±°ë‚˜ ì¤‘ë‹¨í•˜ì„¸ìš”.";
        guide="â€¢ ì €ì¶©ê²© ìš´ë™ìœ¼ë¡œ ëŒ€ì²´\nâ€¢ ì°©ì§€ íŒ¨í„´Â·ì¼€ì´ë˜ìŠ¤ ì ê²€";
      }

      return {status,title,body,guide};
    }

    /* ========== DASHBOARD UPDATE ========== */
    function updateDashboard(p){
      const ts=p.ts || Date.now();
      const d=new Date(ts);
      document.getElementById("lastUpdated").textContent=
        `${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}:${String(d.getSeconds()).padStart(2,"0")}`;

      const angle=p.angleRate_peak_deg_s;
      const rms=p.emg_rms_drop_pct;
      const mdf=p.mdf_drop_pct;

      const risk=p.risk || {};
      const aLv=risk.angleRate || "low";
      const rLv=risk.rmsDrop  || "low";
      const mLv=risk.mdfDrop  || "low";
      const overall=risk.overall || "low";

      document.getElementById("angleRateVal").textContent = fmt(angle);
      const pill=document.getElementById("angleRateLevel");
      pill.className="pill "+levelClass(aLv);
      pill.textContent=aLv.toUpperCase();

      document.getElementById("angleRateMarker").style.left =
        clamp((angle/250)*100)+"%";

      if (emgReportLocked && emgReportSnapshot){
        renderEmg(
          emgReportSnapshot.rmsDrop,
          emgReportSnapshot.mdfDrop,
          emgReportSnapshot.rmsLevel,
          emgReportSnapshot.mdfLevel
        );
      } else {
        renderEmg(rms,mdf,rLv,mLv);
        emgReportSnapshot={rmsDrop:rms, mdfDrop:mdf, rmsLevel:rLv, mdfLevel:mLv};
      }

      const c=getCoaching(overall,aLv,rLv,mLv);
      document.getElementById("guideText").textContent=c.guide;
      document.getElementById("coachStatusText").textContent=c.status;
      document.getElementById("coachTitle").textContent=c.title;
      document.getElementById("coachBody").textContent=c.body;

      const coachP=document.getElementById("coachStatusPill");
      coachP.style.background = overall==="high" ? "#FFE1E1" :
                                overall==="med"  ? "#FFF3D6" : "#E7F4EF";
      coachP.querySelector(".coach-status-pill-dot").style.background =
                                overall==="high" ? "#E53935" :
                                overall==="med"  ? "#FFC107" : "#18A05D";
    }

    /* ========== LOCK BUTTON ========== */
    document.getElementById("lockEmgReportBtn").addEventListener("click", ()=>{
      const s=document.getElementById("lockStatusText");

      if (!emgReportSnapshot){
        s.textContent="ì•„ì§ EMG ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì¡°ê¸ˆ ë” ì›€ì§ì¸ ë’¤ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
        return;
      }

      emgReportLocked=true;
      document.getElementById("lockEmgReportBtn").disabled=true;

      const {rmsDrop, mdfDrop} = emgReportSnapshot;
      s.textContent = getEmgSessionSummary(rmsDrop, mdfDrop);
    });

  </script>
</body>
</html>
